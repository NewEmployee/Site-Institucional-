<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>New Employee | Dashboard</title>
    <link rel="stylesheet" href="dashnova.css">
    <link rel="shortcut icon" type="imagex/png" href="img/icon.ico">
</head>

<body  onload="nome_do_usuario(), nome_da_empresa(), atualizarPg(1), atualizarPg(2), atualizarPg(3), atualizarPg(4)">

<div class="main">
    
    <img class="iconeNE" src="img/icon.ico">
    <span id="empresa" style="color: black;"></span>
    <p class="bemvindo">Bem vindo <span id="usuario"></span>!</p>

    <button id="botao_menu1" class="botoes">Locais</button>

    <button onclick="mudar_tela()" class="botoes" id="botao_menu2">Gráficos</button>

    <button onclick="sair_tela()" class="botoes" id="sair_menu">Sair</button>

    <button onclick="novo_usuario()" class="botoes">Novo usúario</button> 

    

</div>

<div class="dash">
    <div class="regua">
        <div class="item-regua perigo_abaixo">
            <h4 class="status">Perigo</h4>
            <h2>19.9...°C</h2>
        </div>
        <div class="item-regua alerta_abaixo">
            <h4 class="status">Alerta</h4>
            <h2>20.5°C</h2>
        </div>
        <div class="item-regua ideal">
            <h4 class="status">Ideal</h4>
            <h2>20.6°C</h2>
        </div>
       <!--  <div class="item-regua externo">
            <h4 class="status">Temperatura externa</h4>
            <h2 class="temp_externa">0°C</h2>
        </div> -->
        <div class="item-regua ideal">
            <h4 class="status">Ideal</h4>
            <h2>22.4°C</h2>
        </div>
        <div class="item-regua alerta_acima">
            <h4 class="status">Alerta</h4>
            <h2>22.5°C</h2>
        </div>
        <div class="item-regua perigo_acima">
            <h4 class="status">Perigo</h4>
            <h2>23.1...°C</h2>
        </div>
    </div>

    <div class="cards">
        <div class="card" id="local_1" >
            <h1>Local 1</h1>
            <div class="temperatura">
                <p id="temp_aquario_1">26°C</p>
            </div>
            <div class="cor-alerta" id="card_1"></div>
        </div>
        <div class="card" id="local_2">
            <h1>Local 2</h1>
            <div class="temperatura">
                <p id="temp_aquario_2">21°C</p>
            </div>
            <div class="cor-alerta" id="card_2"></div>

        </div>
        <div class="card" id="local_3">
            <h1>Local 3</h1>
            <div class="temperatura">
                <p id="temp_aquario_3">22.4°C</p>
            </div>
            <div class="cor-alerta" id="card_3"></div>
        </div>
        <div class="card" id="local_4">
            <h1>Local 4</h1>
            <div class="temperatura">
                <p id="temp_aquario_4">23°C</p>
            </div>
            <div class="cor-alerta" id="card_4"></div>
        </div>

    </div>

</div>

    
</body>
</html>

<script>
    function nome_do_usuario(){
        usuario.innerHTML = sessionStorage.NOME_USUARIO
    }

    function nome_da_empresa(){
        empresa.innerHTML = sessionStorage.NOME_EMPRESA
    }

    function mudar_tela(){
        window.location = "graficos.html";
    }

    function sair_tela(){
        window.location = "index.html";

    }

    function novo_usuario(){
        window.location = "novo_usuario.html";
    }

    let proximaAtualizacao;

function atualizarPg(idSensor) {

    fetch(`/medidas/tempo-real/${idSensor}`, { cache: 'no-store' }).then(function (response) {
        if (response.ok) {
            response.json().then(function (novoRegistro) {

                console.log(`Dados recebidos: ${JSON.stringify(novoRegistro)}`);

                if(idSensor == 1){
                    temp_aquario_1.innerHTML = (novoRegistro[0].valor_registro).toFixed(2) + "ºC"
                    trocar_Cor(novoRegistro[0].valor_registro, 1)
                } else if (idSensor == 2){
                    temp_aquario_2.innerHTML = (novoRegistro[0].valor_registro).toFixed(2) + "ºC"
                    trocar_Cor(novoRegistro[0].valor_registro, 2)
                } else if (idSensor == 3){
                    temp_aquario_3.innerHTML = (novoRegistro[0].valor_registro).toFixed(2) + "ºC"
                    trocar_Cor(novoRegistro[0].valor_registro, 3)
                } else if (idSensor == 4){
                    temp_aquario_4.innerHTML = (novoRegistro[0].valor_registro).toFixed(2) + "ºC"
                    trocar_Cor(novoRegistro[0].valor_registro, 4)
                }

                // Altere aqui o valor em ms se quiser que o gráfico atualize mais rápido ou mais devagar
                proximaAtualizacao = setTimeout(() => atualizarPg(idSensor), 2000);
            });
        } else {
            console.error('Nenhum dado encontrado ou erro na API');
            // Altere aqui o valor em ms se quiser que o gráfico atualize mais rápido ou mais devagar
            proximaAtualizacao = setTimeout(() => atualizarPg(idSensor), 2000);
        }
    })
        .catch(function (error) {
            console.error(`Erro na obtenção dos dados p/ gráfico: ${error.message}`);
        });
    
    }
    function trocar_Cor(localidade, card){
        var cor = ""
        var txt_alerta = ""
        if(localidade < 22.5 && localidade > 20.5) {
            cor = "#52c352"
            txt_alerta = "Sua temperatura está OK"
        }
        else if(localidade < 23.1 && localidade > 20.5) {
            cor = "#e8e065"
            txt_alerta = "Sua temperatura está AQUECENDO"
        }
        else if(localidade > 23) {
            cor = "#e87b83"
            txt_alerta = "Sua temperatura está MUITO ALTA"
        } 
        else if(localidade > 19.9) {
            cor = "#448dca"
            txt_alerta = "Sua temperatura está ESFRIANDO"
        }
        else {
            cor = "#784bca"
            txt_alerta = "Sua temperatura está CONGELANDO"
        }
        // texto_alerta.innerHTML = txt_alerta
        if(card == 1){
            local_1.style.backgroundColor = cor
        } else if (card == 2){
            local_1.style.backgroundColor = cor
        } else if (card == 3){
            local_1.style.backgroundColor = cor
        } else if (card == 4){
            local_1.style.backgroundColor = cor
        }
        
    }


</script>