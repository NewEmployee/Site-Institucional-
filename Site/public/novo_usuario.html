<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>New Employee | Cadastro</title>
    <link rel="stylesheet" href="novo_usuario.css">
    <link rel="shortcut icon" type="imagex/png" href="img/icon.ico">
</head>

<body>

    <a href="index.html"><img src="img/home.png" id="botao_home"></a>

    <div class="caixa_branca">

        <div class="header">

            <b>Novo usúario</b>

            <img class="img_logo" src="img/cadastro/NEcadastro.png">


            <span> <b>New</b> Employee</span>

            <img class="img_p" src="img/cadastro/imgProdutividade.png">

        </div>

        <div class="informacoes">



            <div class="row">

              
                <div class="div_input">
                    <img src="img/Cadastro/email.png">
                    E-mail do usuario: <br>
                    <input id="input_cadastro_email_usuario" onkeyup="validacao_email_register()"
                    placeholder="Insira o e-mail da empresa">
                    <br>  <span class="form-validation-false" id="msg_email_validation_register"></span>
                    
                </div>

                <div class="div_input">
                    <img src="img/cadastro/cnpj.png">
                    Nome do usuario: <br>
                    <input id="input_cadastro_nome_usuario" onkeyup="validacao_nome_register()"
                     placeholder="Insira seu nome">
                    <br>  <span class="form-validation-false" id="msg_nome_validation_register"></span>
                </div>

            </div>


            

            <div class="row">
                <div class="div_input">
                    <img src="img/cadastro/senha.png">
                    Senha: <br>
                    <input type="password" id="input_cadastro_senha_usuario"
                    placeholder="Insira sua senha" onkeyup="validacao_senha_register()">
                    <br>  <span class="form-validation-false" id="msg_senha_validation_register"></span>
               
                </div>
                 <div class="div_input">
                    <img src="img/cadastro/senha.png">
                    Confirmar senha: <br>
                    <input type="password" id="input_confirmar_senha"
                    placeholder="Insira sua senha">
                    <br> <!--  <span class="form-validation-false" id="msg_senha_validation_register"></span> -->
               
                 </div>

            </div>

            <input id="storage" style="visibility: hidden;">

                <span class="msg-cadastrar">Já é cadastrado? <a href="login.html"> <b> Entrar </b></a></span>  
            <button onclick="cadastrarusuario()">Cadastrar</button>

            
        </div>



    </div>

    <div class="coluna_preta">

        <div class="imagem_preta">
            <img src="img/cadastro/ne_preto.png">
        </div>

        <div class="titulos">
            <a>Serviços</a>
            <a>Social</a>
            <a>Ajuda</a>
            <a>Jurídico</a>
        </div>


        <div class="sub_servicos">
            <br>
            <br>
            <li><a href="">Produtividade</a></li>
            <br>
            <br>
            <li><a href="">Diminuir doenças</a></li>
            <br>
            <br>

            <li><a href="">Ambiente confortável</a></li>

        </div>

        <div class="sub_social">
            <br>
            <br>
            <li><a href="">Facebook</a></li>
            <br>
            <br>
            <li><a href="">Instagram</a></li>
            <br>
            <br>
            <li><a href="">Linkedin</a></li>

        </div>


        <div class="sub_ajuda">
            <br>
            <br>
            <li><a href="">Suporte</a></li>
            <br>
            <br>
            <li><a href="">Contato</a></li>

        </div>



        <div class="sub_juridico">
            <br>
            <br>
            <li><a href="">Termos e condições</a></li>
            <br>
            <br>
            <li><a href="">Política de privacidade</a></li>

        </div>


    </div>

    <div class="footer">
        Copyright©NewEmployee 2022
    </div>



</body>

</html>


<script>
    // Expressões Regulares
     //Expressão Cnpj
     var nomeReg = /^[À-úA-z ]{3,35}$/;
     //Expressão cep
     // Expressão Email
     var emailReg = /^([À-úA-z0-9._-]+@[a-z0-9._-]+\.[A-z0-9_-]+)$/;
    //Expressão Senha
    var senhaReg = /^(?=.*[0-9]{3})(?=.*[A-z]{1})[A-z0-9]{6,}$/;


    function validacao_nome_register() {
        var nome = input_cadastro_nome_usuario.value;
        // Verifica Nome
        if (nome.match(nomeReg)) {
            msg_nome_validation_register.innerHTML = '';
            input_cadastro_nome_usuario.style.border = '1px solid green ';
            input_cadastro_nome_usuario.style.color =" green";
        } else {
            msg_nome_validation_register.innerHTML = '<b style="color: red;"> Verifique o campo preenchido </b>';
            input_cadastro_nome_usuario.style.color = "red";
            input_cadastro_nome_usuario.style.border = '1px solid red' ;
            
    }
    }

    
    // Validacao email
    function validacao_email_register() {
        var email = input_cadastro_email_usuario.value;
        // Verifica email
        if (email.match(emailReg)) {
            msg_email_validation_register.innerHTML = '';
            input_cadastro_email_usuario.style.border = '1px solid green ';
            input_cadastro_email_usuario.style.color =" green";
        } else {
            msg_email_validation_register.innerHTML = '<b style="color: red;"> Verifique o campo preenchido </b>';
            input_cadastro_email_usuario.style.color = "red";
            input_cadastro_email_usuario.style.border = '1px solid red' ;
        }
    }

    // Validacao Senha
     function validacao_senha_register() {
        var senha = input_cadastro_senha_usuario.value;
        // Verifica senha
        if (senha.match(senhaReg)) {
            msg_senha_validation_register.innerHTML = '';
            input_cadastro_senha_usuario.style.border = '2px solid green';
            input_cadastro_senha_usuario.style.color = "green";
        } else {
            msg_senha_validation_register.innerHTML = 
            '<b style="color: red;"> A senha deve conter pelo menos 6 dígitos,<br>1 letra maiúscula, <br>1 letra minúscula <br>e 3 números </b>';
            input_cadastro_senha_usuario.style.color = "red";
            input_cadastro_senha_usuario.style.border = '2px solid red ' ;
        }
    } 

    /* function funcao_senha() {

        if (input_senha.type == "password") {

            input_senha.type = "text";
        }
        else {
            input_senha.type = "password";
        }

    }
    */
    storage.value = sessionStorage.ID_EMPRESA;
    function cadastrarusuario() {

        //Recupere o valor da nova input pelo nome do id
        // Agora vá para o método fetch logo abaixo
        var nome_usuarioVar = input_cadastro_nome_usuario.value
        var email_usuarioVar = input_cadastro_email_usuario.value
        var senha_usuarioVar = input_cadastro_senha_usuario.value
        var confirmar_senhaVar = input_confirmar_senha.value
        var fk_empresaVar = storage.value
        if (nome_usuarioVar == "" || email_usuarioVar == "" || senha_usuarioVar == "" || confirmar_senhaVar == "") {
            alert('Todos os campos são OBRIGATÓRIOS')

        if (senha_usuarioVar != confirmar_senhaVar){
            alert("Confirmar senha invalido")
        }
        } else {

            // Enviando o valor da nova input

            fetch("/usuarios/cadastrarusuario", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify({
                    // crie um atributo que recebe o valor recuperado aqui
                    // Agora vá para o arquivo routes/usuario.js
                    nome_usuarioServer: nome_usuarioVar,
                    email_usuarioServer: email_usuarioVar,
                    senha_usuarioServer: senha_usuarioVar,
                    fk_empresaServer: fk_empresaVar
                })
            }).then(function (resposta) {
                console.log("resposta: ", resposta);
                if (resposta.ok) {
                    window.location = "login.html";
                } else {
                    alert('Houve um erro ao tentar realizar o cadastro, verifique os campos preenchidos!')
                    throw ("Houve um erro ao tentar realizar o cadastro!");
                }
            }).catch(function (resposta) {
                console.log(`#ERRO: ${resposta}`);

            });

              }
    }
</script>